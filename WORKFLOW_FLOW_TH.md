# 🚚 Flow การทำงานของระบบ Subcontractor Truck Management System

## 📋 สารบัญ

1. ภาพรวมของระบบ
2. Flow หลัก: จากการขอรถถึงการจ่ายเงิน
3. รายละเอียดแต่ละขั้นตอน
4. บทบาทและหน้าที่ของผู้ใช้งาน
5. สถานะของงาน (Job Status)
6. การแจ้งเตือนและ Notifications
7. รายงานและสถิติ
8. ความปลอดภัยและการควบคุม
9. การใช้งานระบบ
10. UI/UX Features

---

## 🎯 ภาพรวมของระบบ

ระบบนี้ออกแบบมาเพื่อจัดการงานขนส่งที่ใช้รถจากผู้รับเหมาช่วง (Subcontractor) โดยครอบคลุมตั้งแต่การขอใช้รถ การดำเนินงาน การวางบิล จนถึงการจ่ายเงิน

### ผู้ใช้งานหลักในระบบ

- **Booking Officer** - เจ้าหน้าที่รับคำขอและจัดการงาน
- **Dispatcher** - ผู้ประสานงานและยืนยันการทำงาน
- **Accountant** - เจ้าหน้าที่บัญชีตรวจสอบและออกเอกสาร
- **Admin** - ผู้ดูแลระบบ

---

## 🔄 Flow หลัก จากการขอรถถึงการจ่ายเงิน

```text
┌─────────────────────────────────────────────────────────────────────────┐
│                        FLOW การทำงานของระบบ                              │
└─────────────────────────────────────────────────────────────────────────┘

  1️⃣ สร้างคำขอใช้รถ (Job Request)
      ↓
      📝 Booking Officer กรอกข้อมูลการขอใช้รถ
      ↓
  ┌───────────────────────────────────────────────────────┐
  │ สถานะ: NEW_REQUEST / PENDING_PRICING                 │
  └───────────────────────────────────────────────────────┘
      ↓
  2️⃣ ตรวจสอบและกำหนดราคา
      ↓
      💰 Booking Officer ตรวจสอบราคาจาก Price Matrix
      ↓
      ✅ บันทึกข้อมูลพร้อมราคา (Agreed Price)
      ↓
  ┌───────────────────────────────────────────────────────┐
  │ สถานะ: IN_PROCESS                                     │
  └───────────────────────────────────────────────────────┘
      ↓
  3️⃣ มอบหมายงานและดำเนินการขนส่ง
      ↓
      🚛 Dispatcher มอบหมายงานให้ Subcontractor
      ↓
      📍 ระบุข้อมูล: พนักงานขับรถ, ทะเบียนรถ, เบอร์โทร
      ↓
  ┌───────────────────────────────────────────────────────┐
  │ สถานะ: ASSIGNED (กำลังดำเนินการ)                      │
  └───────────────────────────────────────────────────────┘
      ↓
  4️⃣ ยืนยันการทำงานเสร็จสิ้น
      ↓
      📸 Dispatcher อัพโหลด POD (Proof of Delivery)
      ↓
      📅 ระบุวันที่ถึงจุดหมาย (Actual Arrival Date)
      ↓
      💵 ระบุค่าใช้จ่ายเพิ่มเติม (Extra Charge) ถ้ามี
      ↓
      ✅ ยืนยันการทำงานเสร็จสิ้น
      ↓
  ┌───────────────────────────────────────────────────────┐
  │ สถานะ: COMPLETED                                      │
  │ Accounting Status: PENDING_REVIEW                     │
  └───────────────────────────────────────────────────────┘
      ↓
  5️⃣ ตรวจสอบเอกสารโดยฝ่ายบัญชี
      ↓
      🔍 Accountant ตรวจสอบความถูกต้อง
      ↓
      ┌─────────────────┬─────────────────┐
      │   ✅ อนุมัติ    │   ❌ ปฏิเสธ     │
      └─────────────────┴─────────────────┘
           ↓                    ↓
           │                    └──→ กลับไปที่ Dispatcher
           │                         เพื่อแก้ไขและส่งใหม่
           ↓
  ┌───────────────────────────────────────────────────────┐
  │ Accounting Status: APPROVED                           │
  └───────────────────────────────────────────────────────┘
      ↓
  6️⃣ ออกเอกสารวางบิล (Billing)
      ↓
      📄 Accountant สร้างเอกสารวางบิล
      ↓
      🔢 ระบุเลขที่เอกสาร (Billing Doc No.)
      ↓
      📅 ระบุวันที่วางบิล (Billing Date)
      ↓
      💾 บันทึกและพิมพ์เอกสาร
      ↓
  ┌───────────────────────────────────────────────────────┐
  │ สถานะ: BILLED                                         │
  │ Accounting Status: TO_PAY                             │
  └───────────────────────────────────────────────────────┘
      ↓
  7️⃣ แจ้งชำระเงิน
      ↓
      💳 Accountant อัพโหลดหลักฐานการชำระเงิน (Payment Slip)
      ↓
      📅 ระบุวันที่จ่ายเงิน (Payment Date)
      ↓
      ✅ ยืนยันการจ่ายเงิน
      ↓
  ┌───────────────────────────────────────────────────────┐
  │ สถานะ: BILLED                                         │
  │ Accounting Status: PAID ✅ เสร็จสมบูรณ์               │
  └───────────────────────────────────────────────────────┘

```

---

## 📖 รายละเอียดแต่ละขั้นตอน

### 1️⃣ สร้างคำขอใช้รถ (Job Request Creation)

**ผู้รับผิดชอบ:** Booking Officer

**ขั้นตอน:**

1. เข้าสู่หน้า Job Request Form
2. กรอกข้อมูลที่จำเป็น:
   - 📅 **วันที่ให้บริการ** (Date of Service)
   - 🚛 **ประเภทรถ** (Truck Type)
   - 📍 **ต้นทาง** (Origin)
   - 📍 **ปลายทาง** (Destination)
   - 🏢 **ผู้รับเหมาช่วง** (Subcontractor)
   - 👤 **ผู้ขอใช้รถ** (Requested By)
   - 📝 **หมายเหตุ** (Remark) - ถ้ามี

3. ระบบตรวจสอบราคาอัตโนมัติจาก **Price Matrix**
   - ✅ **มีราคาในระบบ:** แสดงราคาที่ตกลง (Agreed Price)
   - ⚠️ **ไม่มีราคาในระบบ:** สถานะจะเป็น `PENDING_PRICING`

4. กดปุ่ม **"บันทึก"** เพื่อสร้างงาน

**ผลลัพธ์:**

- สร้าง Job ID ใหม่ในระบบ
- สถานะ: `NEW_REQUEST` หรือ `PENDING_PRICING`

---

### 2️⃣ ตรวจสอบและกำหนดราคา (Price Verification)

**ผู้รับผิดชอบ:** Booking Officer

**กรณีที่มีราคาในระบบ:**

- ระบบจะดึงราคาจาก Price Matrix อัตโนมัติ
- แสดงราคาที่ตกลง (Agreed Price)
- สถานะเปลี่ยนเป็น `IN_PROCESS` ทันที

**กรณีที่ไม่มีราคาในระบบ:**

- สถานะจะเป็น `PENDING_PRICING`
- Booking Officer ต้องติดต่อ Subcontractor เพื่อตกลงราคา
- กรอกราคาด้วยตนเอง
- บันทึกข้อมูล → สถานะเปลี่ยนเป็น `IN_PROCESS`

---

### 3️⃣ มอบหมายงานและดำเนินการขนส่ง (Job Assignment & Transportation)

**ผู้รับผิดชอบ:** Dispatcher

**ขั้นตอน:**

1. ดูรายการงานที่สถานะ `IN_PROCESS`
2. ประสานงานกับ Subcontractor
3. รับข้อมูล:
   - 👤 **ชื่อพนักงานขับรถ** (Driver Name)
   - 🚗 **ทะเบียนรถ** (License Plate)
   - 📞 **เบอร์โทรศัพท์** (Phone Number)

4. บันทึกข้อมูลลงในระบบ
5. สถานะเปลี่ยนเป็น `ASSIGNED`

**ระหว่างการขนส่ง:**

- Dispatcher ติดตามความคืบหน้า
- รอรับ POD (Proof of Delivery) จากพนักงานขับรถ

---

### 4️⃣ ยืนยันการทำงานเสร็จสิ้น (Job Completion Confirmation)

**ผู้รับผิดชอบ:** Dispatcher

**ขั้นตอน:**

1. เข้าสู่ **Job Completion View**
2. เลือกงานที่ต้องการยืนยัน
3. เปิด **Confirmation Modal**
4. กรอกข้อมูล:
   - 📅 **วันที่ถึงจุดหมาย** (Actual Arrival Date)
   - 📸 **อัพโหลด POD** (Proof of Delivery) - รูปภาพหรือ PDF
   - 💵 **ค่าใช้จ่ายเพิ่มเติม** (Extra Charge) - ถ้ามี
   - 📝 **เหตุผลค่าใช้จ่ายเพิ่มเติม** (Extra Charge Explanation)

5. กดปุ่ม **"ยืนยันการทำงานเสร็จสิ้น"**

**ผลลัพธ์:**

- สถานะเปลี่ยนเป็น `COMPLETED`
- Accounting Status: `PENDING_REVIEW`
- งานถูกส่งไปยังฝ่ายบัญชีเพื่อตรวจสอบ

---

### 5️⃣ ตรวจสอบเอกสารโดยฝ่ายบัญชี (Accounting Verification)

**ผู้รับผิดชอบ:** Accountant

**ขั้นตอน:**

1. เข้าสู่ **Accounting Verification View**
2. ดูรายการงานที่สถานะ `PENDING_REVIEW`
3. ตรวจสอบความถูกต้อง:
   - ✅ ข้อมูลการขนส่ง
   - ✅ POD (Proof of Delivery)
   - ✅ ราคาที่ตกลง
   - ✅ ค่าใช้จ่ายเพิ่มเติม

**กรณีอนุมัติ:**

- กดปุ่ม **"อนุมัติ" (Approve)**
- Accounting Status เปลี่ยนเป็น `APPROVED`
- พร้อมออกเอกสารวางบิล

**กรณีปฏิเสธ:**

- กดปุ่ม **"ปฏิเสธ" (Reject)**
- กรอก **เหตุผลการปฏิเสธ** (Rejection Reason)
- งานกลับไปที่ Dispatcher พร้อม **Red Flag Warning**
- Dispatcher แก้ไขและส่งใหม่

---

### 6️⃣ ออกเอกสารวางบิล (Billing Document Generation)

**ผู้รับผิดชอบ:** Accountant

**ขั้นตอน:**

1. เข้าสู่ **Billing & Financial Dashboard**
2. เลือกแท็บ **"APPROVED"**
3. เลือกงานที่ต้องการออกเอกสาร
4. กดปุ่ม **"ออกเอกสารวางบิล"**
5. กรอกข้อมูล:
   - 🔢 **เลขที่เอกสาร** (Billing Doc No.)
   - 📅 **วันที่วางบิล** (Billing Date)

6. ตรวจสอบข้อมูลในเอกสาร:
   - ข้อมูลบริษัท
   - รายละเอียดงาน
   - ราคาทั้งหมด (Agreed Price + Extra Charge)
   - ภาษีมูลค่าเพิ่ม (VAT)
   - ยอดรวมทั้งสิ้น

7. กดปุ่ม **"บันทึกและพิมพ์"**

**ผลลัพธ์:**

- สถานะเปลี่ยนเป็น `BILLED`
- Accounting Status: `TO_PAY`
- เอกสารพร้อมส่งให้ Subcontractor

---

### 7️⃣ แจ้งชำระเงิน (Payment Notification)

**ผู้รับผิดชอบ:** Accountant

**ขั้นตอน:**

1. เข้าสู่ **Billing & Financial Dashboard**
2. เลือกแท็บ **"TO PAY"**
3. เลือกงานที่ได้รับการชำระเงินแล้ว
4. กดปุ่ม **"แจ้งชำระเงิน"**
5. อัพโหลดหลักฐาน:
   - 📸 **สลิปการโอนเงิน** (Payment Slip)
   - 📅 **วันที่จ่ายเงิน** (Payment Date)

6. กดปุ่ม **"ยืนยันการจ่ายเงิน"**

**ผลลัพธ์:**

- Accounting Status เปลี่ยนเป็น `PAID`
- งานเสร็จสมบูรณ์ทั้งหมด ✅
- ย้ายไปยังแท็บ **"PAID"**

---

## 👥 บทบาทและหน้าที่ของผู้ใช้งาน

### 📝 Booking Officer (เจ้าหน้าที่รับจอง)

**หน้าที่หลัก:**

- สร้างคำขอใช้รถใหม่
- ตรวจสอบและกำหนดราคา
- แก้ไขข้อมูลงานที่ยังไม่ได้มอบหมาย

**Dashboard:**

- **My Tasks:** งานที่ตนเองสร้าง
- **Kanban Board:**
  - Pending (รอดำเนินการ)
  - In Progress (กำลังดำเนินการ)
  - Completed (เสร็จสิ้น)

---

### 🚛 Dispatcher (ผู้ประสานงาน)

**หน้าที่หลัก:**

- มอบหมายงานให้ Subcontractor
- ระบุข้อมูลพนักงานขับรถและรถ
- ยืนยันการทำงานเสร็จสิ้น
- อัพโหลด POD
- แก้ไขงานที่ถูกปฏิเสธโดยฝ่ายบัญชี

**Dashboard:**

- **Job Summary Board:** สรุปงานทั้งหมด
- **Job Completion View:** งานที่รอยืนยันความเสร็จสิ้น
- **Red Flag Warnings:** งานที่ถูกปฏิเสธ

---

### 💰 Accountant (เจ้าหน้าที่บัญชี)

**หน้าที่หลัก:**

- ตรวจสอบและอนุมัติงานที่เสร็จสิ้น
- ออกเอกสารวางบิล
- แจ้งชำระเงิน
- จัดการเอกสารทางการเงิน

**Dashboard:**

- **Billing & Financial Dashboard:**
  - PENDING REVIEW (รอตรวจสอบ)
  - APPROVED (อนุมัติแล้ว)
  - TO PAY (รอชำระเงิน)
  - PAID (จ่ายเงินแล้ว)

---

### 🔧 Admin (ผู้ดูแลระบบ)

**หน้าที่หลัก:**

- จัดการผู้ใช้งาน
- ตั้งค่าระบบ
- จัดการ Price Matrix
- ดูรายงานทั้งหมด

---

## 📊 สถานะของงาน Job Status

### Primary Job Status

| สถานะ | ความหมาย | ผู้รับผิดชอบ |
| --- | --- | --- |
| `NEW_REQUEST` | คำขอใหม่ที่มีราคาในระบบ | Booking Officer |
| `PENDING_PRICING` | รอกำหนดราคา | Booking Officer |
| `IN_PROCESS` | อยู่ระหว่างดำเนินการ | Dispatcher |
| `ASSIGNED` | มอบหมายงานแล้ว กำลังขนส่ง | Dispatcher |
| `COMPLETED` | ทำงานเสร็จสิ้น รอตรวจสอบ | Accountant |
| `BILLED` | ออกเอกสารวางบิลแล้ว | Accountant |

### Accounting Status

| สถานะ | ความหมาย | ขั้นตอนถัดไป |
| --- | --- | --- |
| `PENDING_REVIEW` | รอฝ่ายบัญชีตรวจสอบ | อนุมัติหรือปฏิเสธ |
| `APPROVED` | อนุมัติแล้ว | ออกเอกสารวางบิล |
| `REJECTED` | ปฏิเสธ ต้องแก้ไข | Dispatcher แก้ไขและส่งใหม่ |
| `TO_PAY` | รอชำระเงิน | แจ้งชำระเงิน |
| `PAID` | จ่ายเงินแล้ว | เสร็จสมบูรณ์ ✅ |

---

## 🔔 การแจ้งเตือนและ Notifications

### Red Flag Warning (งานที่ถูกปฏิเสธ)

- 🔴 **กรอบสีแดง** รอบการ์ดงาน
- ⚠️ **Badge กระพริบ** แสดงสถานะปฏิเสธ
- 📊 **Progress Bar สีแดง**
- 📝 แสดงเหตุผลการปฏิเสธ

### Timeline Tracking

ผู้ใช้สามารถดู Timeline ของงานได้ทุกขั้นตอน:

1. ✅ สร้างคำขอบริการ
2. 🚛 ดำเนินการขนส่ง
3. 📄 เอกสารวางบิล
4. 💳 สถานะการจ่ายเงิน

---

## 📈 รายงานและสถิติ

### Dashboard Analytics

- 📊 จำนวนงานทั้งหมด
- ⏳ งานที่กำลังดำเนินการ
- ✅ งานที่เสร็จสิ้น
- 💰 รายได้รวม
- 📅 งานแยกตามวัน/เดือน

### Recent Transactions

- ตารางแสดงธุรกรรมล่าสุด
- ค้นหาและกรองข้อมูล
- Pagination
- Sticky Header

---

## 🔒 ความปลอดภัยและการควบคุม

### การควบคุมสิทธิ์

- แต่ละ Role มีสิทธิ์เฉพาะที่กำหนด
- ไม่สามารถแก้ไขข้อมูลของผู้อื่นได้
- ต้องมีรหัสผ่านสำหรับการตั้งค่าที่สำคัญ

### การบันทึกข้อมูล

- ทุก Transaction บันทึกลง Firebase
- มี Timestamp ทุกการเปลี่ยนแปลง
- สามารถตรวจสอบย้อนหลังได้

---

## 📱 การใช้งานระบบ

### การเข้าสู่ระบบ

1. เลือกผู้ใช้งานจาก Dropdown
2. กรอกรหัสผ่าน
3. กด Login

### การออกจากระบบ

- กดปุ่ม Logout ที่มุมบนขวา

### การดู Job Tracking

- คลิกที่การ์ดงานใดๆ
- ดู Timeline แบบละเอียด
- ติดตามสถานะแบบ Real-time

---

## 🎨 UI/UX Features

### Modern Design

- 🎨 Glassmorphism Effects
- 🌈 Gradient Colors
- ✨ Smooth Animations
- 📱 Responsive Design

### Interactive Elements

- Hover Effects
- Loading States
- Success/Error Notifications
- Modal Dialogs

---

## 📞 การติดต่อและการสนับสนุน

หากมีปัญหาหรือข้อสงสัย:

- 📧 ติดต่อ Admin
- 📖 อ่าน Documentation
- 🔧 ตรวจสอบ System Settings

---

## 🚀 สรุป

ระบบนี้ออกแบบมาเพื่อให้การจัดการงานขนส่งเป็นไปอย่างมีประสิทธิภาพ โดยแบ่งหน้าที่ชัดเจนตามบทบาท และมีการติดตามสถานะแบบ Real-time ตั้งแต่การขอรถจนถึงการจ่ายเงิน

### Flow สั้นๆ

```text
ขอรถ → กำหนดราคา → มอบหมายงาน → ขนส่ง → ยืนยันเสร็จ →
ตรวจสอบ → ออกบิล → จ่ายเงิน ✅
```

---

เอกสารนี้สร้างขึ้นเพื่อให้ผู้ใช้งานเข้าใจ Flow การทำงานของระบบ Subcontractor Truck Management System

อัพเดทล่าสุด: 16 มกราคม 2026
